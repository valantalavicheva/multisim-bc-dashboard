<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MultiSIM Business Case</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    :root{--bg:#0b1220;--panel:#0f1b33;--muted:#9db0d0;--text:#e9f0ff;--accent:#7aa2ff;--accent2:#5eead4;--border:rgba(255,255,255,.08);}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#070b14,#0b1220);color:var(--text);}
    header{padding:18px 22px;border-bottom:1px solid var(--border);position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(11,18,32,.72);}
    header h1{margin:0;font-size:16px;font-weight:650;}
    header .sub{margin-top:6px;color:var(--muted);font-size:12px;}
    .wrap{max-width:1200px;margin:0 auto;padding:18px 14px 42px;}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:14px;align-items:start;}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}}
    .card{background:rgba(15,27,51,.72);border:1px solid var(--border);border-radius:14px;padding:14px;}
    .card h2{margin:0 0 10px 0;font-size:13px;color:#dbe7ff;font-weight:650;}
    .row{display:grid;grid-template-columns:1fr 120px;gap:10px;margin:10px 0;align-items:center;}
    .row label{font-size:12px;color:#dbe7ff;}
    .row .val{font-size:12px;color:var(--muted);text-align:right;}
    input[type=range]{width:100%;}
    input[type=number]{width:100%;padding:8px;border-radius:10px;border:1px solid var(--border);background:#0b142a;color:var(--text);}
    .tabs{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;}
    .tab{padding:8px 10px;border-radius:12px;border:1px solid var(--border);background:#0b142a;color:var(--muted);font-size:12px;cursor:pointer;}
    .tab.active{background:rgba(122,162,255,.18);color:var(--text);}
    .tabpane{display:none;}
    .tabpane.active{display:block;}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:10px;}
    @media(max-width:980px){.kpis{grid-template-columns:repeat(2,1fr);}}
    .kpi{padding:12px;border-radius:12px;border:1px solid var(--border);background:rgba(11,20,42,.8);}
    .kpi .t{font-size:11px;color:var(--muted);}
    .kpi .v{margin-top:6px;font-size:16px;font-weight:700;}
    .note{font-size:12px;color:var(--muted);line-height:1.35;}
    .mono{font-family:monospace;}
    table{width:100%;border-collapse:collapse;font-size:11px;}
    th,td{padding:6px 8px;border-bottom:1px solid var(--border);}
    th{text-align:left;color:#dbe7ff;background:rgba(0,0,0,0.3);}
    td{color:var(--muted);}
    td.num{color:var(--text);text-align:right;}
    .foot{margin-top:10px;font-size:11px;color:var(--muted);}
  </style>
</head>
<body>
  <header>
    <h1>MultiSIM Business Case</h1>
    <div class="sub">12-month projection ‚Ä¢ comparison</div>
  </header>
  <div class="wrap">
    <div class="grid">
      <div class="card">
        <h2>Inputs</h2>
        <div class="row"><label>Consumer Base</label><div class="val"><span id="baseVal" class="mono"></span></div></div>
        <input id="base" type="number" value="1500000">
        <div class="row"><label>Monthly Fee (BGN)</label><div class="val"><span id="mfVal" class="mono"></span></div></div>
        <input id="mf" type="number" value="4.99" step="0.01">
        <div class="row"><label>Activation Fee (BGN)</label><div class="val"><span id="afVal" class="mono"></span></div></div>
        <input id="af" type="number" value="14.99" step="0.01">
        <div class="row"><label>Avg Devices/User</label><div class="val"><span id="devicesVal" class="mono"></span></div></div>
        <input id="devices" type="range" min="1" max="3" step="0.1" value="1.2">
        <div class="row"><label>Take Rate (%)</label><div class="val"><span id="penVal" class="mono"></span></div></div>
        <input id="pen" type="range" min="0" max="2" step="0.01" value="0.11">
        <div class="row"><label>Active Base</label><div class="val"><span id="activeBaseVal" class="mono"></span></div></div>
        <div class="row"><label>Churn (%)</label><div class="val"><span id="churnVal" class="mono"></span></div></div>
        <input id="churn" type="range" min="0.5" max="5" step="0.1" value="2">
      </div>
      <div>
        <div class="card" style="margin-bottom:14px;">
          <div class="tabs">
            <div class="tab active" data-tab="1">üìà Revenue</div>
            <div class="tab" data-tab="2">üí∏ Promo</div>
            <div class="tab" data-tab="3">üìä Compare</div>
            <div class="tab" data-tab="4">üìã Metrics</div>
            <div class="tab" data-tab="5">üìä Monthly</div>
            <div class="tab" data-tab="6">‚ÑπÔ∏è Notes</div>
          </div>
          <div id="pane1" class="tabpane active">
            <div class="kpis">
              <div class="kpi"><div class="t">Revenue A</div><div class="v" id="kpiRevA"></div></div>
              <div class="kpi"><div class="t">Revenue B</div><div class="v" id="kpiRevB"></div></div>
              <div class="kpi"><div class="t">Activations</div><div class="v" id="kpiActs"></div></div>
              <div class="kpi"><div class="t">Break-even</div><div class="v" id="kpiBE"></div></div>
            </div>
            <div id="chartRevenue" style="height:350px;"></div>
          </div>
          <div id="pane2" class="tabpane">
            <div class="note" style="margin:6px 0 12px;">Foregone = free months. Actual = real cash.</div>
            <div id="chartPromo" style="height:350px;"></div>
          </div>
          <div id="pane3" class="tabpane"><div id="tableWrap"></div></div>
          <div id="pane4" class="tabpane">
            <div class="note" style="margin:6px 0 12px;"><b>Metrics by month</b></div>
            <div id="chartMetrics" style="height:250px;"></div>
            <div id="metricsTableWrap" style="margin-top:14px;"></div>
          </div>
          <div id="pane5" class="tabpane">
            <div class="note" style="margin:6px 0 12px;"><b>Monthly profit table</b></div>
            <div id="chartMonthly" style="height:250px;"></div>
            <div id="monthlyProfitTable" style="margin-top:14px;overflow-x:auto;"></div>
          </div>
          <div id="pane6" class="tabpane">
            <div class="note">
              Simple model: activation fee + monthly fee.
            No promos considered in this view.
            </div>
          </div>
        </div>
        <div class="card"><h2>Summary</h2><div class="note" id="quickOutputs"></div></div>
      </div>
    </div>
  </div>
<script>
function fmtBGN(x){return(isFinite(x)?x:0).toLocaleString('bg-BG',{maximumFractionDigits:0})+' –ª–≤';}
function fmtNum(x){return(isFinite(x)?x:0).toLocaleString('bg-BG',{maximumFractionDigits:0});}
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}

function simulate(p){
  const m=12,base=p.base,mf=p.mf,af=p.af,avgD=p.avgDevices,pen=p.pen/100,churn=p.churn/100;
  const totalAdopters=base*pen,totalSIMs=totalAdopters*avgD,newSIMsPerMonth=totalSIMs/m;
  let cohorts=[];
  let cum=0;
  const res={months:Array.from({length:m},(_,i)=>i+1),active:[],cashTotal:[],cum:[]};
  for(let i=0;i<m;i++){
    cohorts.push({size:newSIMsPerMonth});
    const cf=1-churn;
    cohorts=cohorts.map(c=>({size:c.size*cf}));
    let sub=cohorts.reduce((s,c)=>s+(c.size*mf),0);
    let act=newSIMsPerMonth*af;
    let tot=act+sub;
    cum+=tot;
    res.active.push(cohorts.reduce((s,c)=>s+c.size,0));
    res.cashTotal.push(tot);
    res.cum.push(cum);
  }
  res.totalCash=res.cashTotal.reduce((a,b)=>a+b,0);
  res.totalActs=totalSIMs;
  return res;
}

const $=(id)=>document.getElementById(id);
function params(){
  return{
    base:clamp(parseFloat($('base').value)||1500000,1,1e9),
    mf:clamp(parseFloat($('mf').value)||4.99,0,1e6),
    af:clamp(parseFloat($('af').value)||14.99,0,1e6),
    avgDevices:clamp(parseFloat($('devices').value)||1.2,1,3),
    pen:clamp(parseFloat($('pen').value)||2,0,10),
    churn:clamp(parseFloat($('churn').value)||2,0.5,5)/100
  };
}
function refreshLabels(p){
  $('baseVal').textContent=fmtNum(p.base);
  $('mfVal').textContent=p.mf.toFixed(2)+' –ª–≤';
  $('afVal').textContent=p.af.toFixed(2)+' –ª–≤';
  $('devicesVal').textContent=p.avgDevices.toFixed(1);
  $('penVal').textContent=p.pen.toFixed(1)+'%'; var activeBase=Math.round(p.base*(p.pen/100)*p.avgDevices); $('activeBaseVal').textContent=activeBase.toLocaleString('bg-BG');
  
  $('churnVal').textContent=(p.churn*100).toFixed(1)+'%';
}
function render(r,p){
  $('kpiRevA').textContent=fmtBGN(r.totalCash);
  $('kpiRevB').textContent='‚Äî';
  $('kpiActs').textContent=fmtNum(r.totalActs);
  $('kpiBE').textContent='‚Äî';
  
  // Revenue chart
  const trace={x:r.months,y:r.cum,type:'scatter',mode:'lines+markers',name:'Revenue',line:{color:'#7aa2ff',width:3}};
  Plotly.react('chartRevenue',[trace],{paper_bgcolor:'transparent',plot_bgcolor:'transparent',margin:{l:50,r:20,t:20,b:40},xaxis:{title:'Month',gridcolor:'rgba(255,255,255,0.06)'},yaxis:{title:'Revenue (–ª–≤)',gridcolor:'rgba(255,255,255,0.06)',tickformat:','},legend:{orientation:'h',x:0,y:1.1},font:{color:'#e9f0ff'}},{displayModeBar:false});
  
  // Promo chart
  const bar={x:['Revenue'],y:[r.totalCash],name:'Actual',type:'bar',marker:{color:'rgba(94,234,212,0.55)'}};
  Plotly.react('chartPromo',[bar],{barmode:'group',paper_bgcolor:'transparent',plot_bgcolor:'transparent',margin:{l:50,r:20,t:20,b:40},xaxis:{gridcolor:'rgba(255,255,255,0.06)'},yaxis:{title:'–ª–≤',gridcolor:'rgba(255,255,255,0.06)',tickformat:','},legend:{orientation:'h',x:0,y:1.1},font:{color:'#e9f0ff'}},{displayModeBar:false});
  
  // Compare table
  let html='<table><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody>';
  html+='<tr><td>Total Revenue</td><td class="num">'+fmtBGN(r.totalCash)+'</td></tr>';
  html+='<tr><td>Total Activations</td><td class="num">'+fmtNum(Math.round(r.totalActs))+'</td></tr>';
  html+='</tbody></table>';
  $('tableWrap').innerHTML=html;
  
  // Metrics chart (monthly revenue diff)
  const rev=r.cashTotal;
  const traceM={x:r.months,y:rev,type:'scatter',mode:'lines+markers',name:'Revenue',line:{color:'#7aa2ff',width:2}};
  Plotly.react('chartMetrics',[traceM],{paper_bgcolor:'transparent',plot_bgcolor:'transparent',margin:{l:50,r:20,t:20,b:40},xaxis:{title:'Month',gridcolor:'rgba(255,255,255,0.06)'},yaxis:{title:'–ª–≤',gridcolor:'rgba(255,255,255,0.06)',tickformat:','},legend:{orientation:'h',x:0,y:1.1},font:{color:'#e9f0ff'}},{displayModeBar:false});
  
  // Monthly profit table - simple model using r.active and r.cum
  var takeRate = (p.pen * 100).toFixed(2);
  var churnPct = (p.churn * 100).toFixed(1);
  var totalSIMs = p.base * p.pen * p.avgDevices;
  var newSIMsPerMonth = totalSIMs / 12;
  
  var mHtml = '<table><thead><tr><th>Metric</th>';
  for(var i = 1; i <= 12; i++) mHtml += '<th>' + i + '</th>';
  mHtml += '<th>Total</th></tr></thead><tbody>';
  
  mHtml += '<tr><td><b>Consumer Base</b></td>';
  var totalBase = 0;
  r.months.forEach(function() { mHtml += '<td class="num">' + fmtNum(p.base) + '</td>'; totalBase += p.base; });
  mHtml += '<td class="num"><b>' + fmtNum(totalBase) + '</b></td></tr>';
  
  mHtml += '<tr><td><b>Take Rate (%)</b></td>';
  r.months.forEach(function() { mHtml += '<td class="num">' + takeRate + '</td>'; });
  mHtml += '<td class="num">‚Äî</td></tr>';
  
  mHtml += '<tr><td><b>Churn (%)</b></td>';
  r.months.forEach(function() { mHtml += '<td class="num">' + churnPct + '</td>'; });
  mHtml += '<td class="num">‚Äî</td></tr>';
  
  mHtml += '<tr><td>Active Base (after churn)</td>';
  r.active.forEach(function(v) { mHtml += '<td class="num">' + fmtNum(Math.round(v)) + '</td>'; });
  mHtml += '<td class="num">‚Äî</td></tr>';
  
  mHtml += '<tr><td>Rev Activation</td>';
  r.active.forEach(function(v, i) { var rev = newSIMsPerMonth * p.af; mHtml += '<td class="num">' + fmtBGN(rev) + '</td>'; });
  mHtml += '<td class="num">' + fmtBGN(newSIMsPerMonth * p.af * 12) + '</td></tr>';
  
  mHtml += '<tr><td>Rev Subscription</td>';
  var totalSub = 0;
  r.active.forEach(function(v) { mHtml += '<td class="num">' + fmtBGN(v * p.mf) + '</td>'; totalSub += v * p.mf; });
  mHtml += '<td class="num"><b>' + fmtBGN(totalSub) + '</b></td></tr>';
  
  mHtml += '<tr><td><b>Monthly Profit</b></td>';
  var totalProfit = 0;
  r.cashTotal.forEach(function(v) { mHtml += '<td class="num">' + fmtBGN(v) + '</td>'; totalProfit += v; });
  mHtml += '<td class="num"><b>' + fmtBGN(totalProfit) + '</b></td></tr>';
  
  mHtml += '<tr><td><b>Cumulative</b></td>';
  r.cum.forEach(function(v) { mHtml += '<td class="num">' + fmtBGN(v) + '</td>'; });
  mHtml += '<td class="num"><b>' + fmtBGN(r.totalCash) + '</b></td></tr>';
  
  mHtml += '</tbody></table>';
  $('monthlyProfitTable').innerHTML = mHtml;

  // Quick outputs
  const adopters=p.base*(p.pen/100);
  $('quickOutputs').innerHTML='<div>Target adopters: <span class="mono">'+fmtNum(adopters)+'</span></div><div>Total SIMs: <span class="mono">'+fmtNum(adopters*p.avgDevices)+'</span></div>';
}

function update(){const p=params();refreshLabels(p);const r=simulate(p);render(r,p);}

// Tab switching
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const num=t.dataset.tab;
    document.querySelectorAll('.tabpane').forEach(p=>p.classList.remove('active'));
    $('pane'+num).classList.add('active');
    window.dispatchEvent(new Event('resize'));
  });
});

// Input listeners
['base','mf','af','devices','pen','churn'].forEach(id=>{
  $(id).addEventListener('input',update);
  $(id).addEventListener('change',update);
});

update();
</script>
</body>
</html>
